# 微信小程序设置指南

## 📱 第一步：打开微信开发者工具

1. **下载并安装微信开发者工具**
   - 访问：https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html
   - 下载对应系统的版本并安装

2. **启动微信开发者工具**
   - 打开已安装的微信开发者工具

## 🔧 第二步：创建/导入项目

### 方式一：导入现有项目（推荐）

1. 在微信开发者工具中，点击 **"+"** 或 **"导入项目"**

2. **填写项目信息**：
   - **项目目录**: 选择 `course/miniprogram` 目录
   - **AppID**: 
     - 如果有正式 AppID，填写你的 AppID
     - 如果没有，选择 **"测试号"** 或 **"不使用云服务"**
   - **项目名称**: `课程记录管理`（可自定义）

3. 点击 **"导入"**

### 方式二：新建项目

1. 点击 **"+"** 创建新项目
2. 选择 **"小程序"**
3. 填写项目信息（同上）
4. 创建后，将 `miniprogram` 目录下的所有文件复制到新项目目录

## ⚙️ 第三步：配置开发环境

### 1. 设置不校验合法域名（开发环境必须）

1. 在微信开发者工具中，点击右上角的 **"详情"** 或 **"设置"**
2. 选择 **"项目设置"** → **"本地设置"**
3. **勾选以下选项**：
   - ✅ **不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书**
   - ✅ **不校验安全域名 TLS 版本**

**重要**: 这个设置只在开发环境有效，生产环境必须配置合法域名。

### 2. 检查 API 地址配置

打开 `miniprogram/app.js`，确认 API 地址：

```javascript
globalData: {
  apiBaseUrl: 'http://localhost:9000/api' // 开发环境
}
```

**注意**：
- 开发环境可以使用 `localhost`
- 如果使用真机调试，需要改为局域网 IP，例如：`http://192.168.1.100:9000/api`

### 3. 获取局域网 IP（真机调试需要）

**Mac/Linux**:
```bash
ifconfig | grep "inet " | grep -v 127.0.0.1
```

**Windows**:
```bash
ipconfig
```

找到类似 `192.168.x.x` 的 IP 地址，然后修改 `app.js` 中的 `apiBaseUrl`。

## 🚀 第四步：启动后端服务

确保后端服务已启动：

```bash
cd /Users/jiangjiankang/work/programe/course
docker-compose up -d
```

检查服务状态：
```bash
docker-compose ps
```

## 🧪 第五步：测试小程序

### 1. 编译项目

在微信开发者工具中：
- 点击 **"编译"** 按钮
- 等待编译完成

### 2. 测试功能

#### 测试首页
- 查看 Banner 轮播图（应该显示 3 条测试数据）
- 查看课程列表（需要先登录）

#### 测试登录
1. 点击底部 **"我的"** tab
2. 点击 **"立即登录"** 按钮
3. 进行微信授权
4. 登录成功后，返回首页查看课程列表

#### 测试课程功能
1. 点击课程卡片进入详情
2. 查看记录列表
3. 点击 **"新增记录"** 按钮

#### 测试记录功能
1. 点击记录进入详情
2. 点击 **"编辑"** 修改备注
3. 点击 **"+ 添加图片"** 上传图片
4. 点击图片预览
5. 删除图片

## 🔍 常见问题解决

### 问题1：网络请求失败

**错误信息**: `request:fail` 或 `网络错误`

**解决方案**:
1. 确认后端服务运行正常：`docker-compose ps`
2. 确认 API 地址正确
3. 确认已勾选"不校验合法域名"
4. 查看控制台错误信息

### 问题2：登录失败

**错误信息**: `登录失败` 或 `获取openid失败`

**解决方案**:
1. 检查 `.env` 文件中的 `WX_APPID` 和 `WX_SECRET` 是否正确
2. 如果使用测试号，可能需要修改后端代码支持测试登录
3. 查看后端日志：`docker-compose logs api`

### 问题3：真机调试无法连接

**问题**: 真机上无法访问 localhost

**解决方案**:
1. 获取电脑的局域网 IP
2. 修改 `app.js` 中的 `apiBaseUrl` 为局域网 IP
3. 确保手机和电脑在同一 WiFi 网络
4. 或者使用内网穿透工具（如 ngrok）

### 问题4：TabBar 不显示

**问题**: 底部导航栏不显示

**解决方案**:
- 当前配置已简化，只使用文字标签
- 如果还是不显示，检查 `app.json` 中的 `tabBar` 配置

## 📝 开发调试技巧

### 1. 查看日志

**小程序控制台**:
- 在微信开发者工具中查看 Console 面板
- 查看 Network 面板查看网络请求

**后端日志**:
```bash
docker-compose logs -f api
```

### 2. 调试 API

使用 Postman 或 curl 测试 API：

```bash
# 测试健康检查
curl http://localhost:9000/health

# 测试 Banner
curl http://localhost:9000/api/banners
```

### 3. 查看数据库

访问 phpMyAdmin: http://localhost:9080
- 服务器: `mysql`
- 用户名: `root`
- 密码: `course123456`

## 🎯 快速检查清单

在开始测试前，确认以下事项：

- [ ] 微信开发者工具已安装并打开
- [ ] 项目已导入（选择 `miniprogram` 目录）
- [ ] 已设置"不校验合法域名"
- [ ] 后端服务已启动（`docker-compose ps` 显示运行中）
- [ ] API 地址配置正确（`app.js` 中的 `apiBaseUrl`）
- [ ] 已创建测试数据（可选，运行 `docker-compose exec api node scripts/init-data.js`）

## 📚 相关文档

- [快速开始指南](./快速开始.md)
- [测试说明](./测试说明.md)
- [API 接口文档](./docs/api/README.md)
- [前端开发文档](./docs/frontend/README.md)

## 🎉 开始使用

完成以上步骤后，你就可以开始测试和使用小程序了！

如果遇到任何问题，请查看：
1. 微信开发者工具的 Console 面板
2. 后端服务日志：`docker-compose logs api`
3. 相关文档

