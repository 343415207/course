# 项目测试说明

## 🎉 服务已成功启动！

### 服务状态

所有服务已通过 Docker Compose 启动并运行正常：

- ✅ **MySQL 数据库**: 运行在端口 `9306`
- ✅ **phpMyAdmin**: 运行在 `http://localhost:9080`
- ✅ **API 服务**: 运行在 `http://localhost:9000`
- ✅ **数据库表**: 已自动创建

## 📍 访问地址

### 1. API 服务
- **健康检查**: http://localhost:9000/health
- **API 基础地址**: http://localhost:9000/api
- **Banner 列表**: http://localhost:9000/api/banners

### 2. phpMyAdmin（数据库管理）
- **访问地址**: http://localhost:9080
- **服务器**: `mysql`
- **用户名**: `root`
- **密码**: `course123456`

### 3. 数据库连接
- **主机**: `localhost`
- **端口**: `9306`
- **数据库名**: `course_db`
- **用户名**: `root`
- **密码**: `course123456`

## 🧪 测试 API 接口

### 1. 测试健康检查
```bash
curl http://localhost:9000/health
```

### 2. 测试 Banner 列表（公开接口）
```bash
curl http://localhost:9000/api/banners
```

### 3. 测试微信登录（需要真实的 code）
```bash
curl -X POST http://localhost:9000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "code": "微信登录code",
    "userInfo": {
      "nickName": "测试用户",
      "avatarUrl": "https://example.com/avatar.jpg"
    }
  }'
```

## 📱 小程序测试

### 1. 打开微信开发者工具
1. 打开微信开发者工具
2. 选择"导入项目"
3. 选择 `miniprogram` 目录
4. 填写 AppID（可使用测试号）

### 2. 配置开发环境
在 `miniprogram/app.js` 中，确保 API 地址正确：
```javascript
apiBaseUrl: 'http://localhost:9000/api' // 开发环境
```

### 3. 开发环境设置
在微信开发者工具中：
- 设置 → 项目设置 → 本地设置
- 勾选"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"

### 4. 测试功能
1. **登录功能**: 点击"我的"页面，进行微信授权登录
2. **首页**: 查看 Banner 轮播图和课程列表
3. **课程详情**: 点击课程卡片，查看记录列表
4. **新增记录**: 点击"新增记录"按钮
5. **记录详情**: 点击记录，编辑备注和上传图片

## 🔍 查看日志

### 查看所有服务日志
```bash
docker-compose logs -f
```

### 查看 API 服务日志
```bash
docker-compose logs -f api
```

### 查看 MySQL 日志
```bash
docker-compose logs -f mysql
```

## 🛠️ 常用命令

### 重启服务
```bash
docker-compose restart
```

### 停止服务
```bash
docker-compose down
```

### 停止并删除数据（谨慎使用）
```bash
docker-compose down -v
```

### 进入 API 容器
```bash
docker-compose exec api sh
```

### 进入 MySQL 容器
```bash
docker-compose exec mysql bash
```

## 📝 注意事项

1. **微信小程序配置**:
   - 需要在微信公众平台配置 AppID 和 Secret
   - 开发环境可以设置"不校验合法域名"
   - 生产环境必须配置合法域名和 HTTPS

2. **数据库**:
   - 数据存储在 Docker volume 中，删除容器不会丢失数据
   - 可以通过 phpMyAdmin 管理数据库

3. **API 测试**:
   - 可以使用 Postman 或 curl 测试接口
   - 需要登录的接口需要先获取 Token

4. **图片上传**:
   - 图片上传到腾讯云 COS
   - 需要配置正确的 COS 凭证

## 🐛 故障排查

### API 服务无法访问
1. 检查服务是否运行: `docker-compose ps`
2. 查看日志: `docker-compose logs api`
3. 检查端口是否被占用

### 数据库连接失败
1. 确认 MySQL 容器运行正常
2. 检查 `.env` 文件中的数据库配置
3. 确认网络配置正确

### 小程序无法连接 API
1. 检查 API 地址是否正确
2. 开发环境勾选"不校验合法域名"
3. 检查网络连接

## 📚 相关文档

- [API 接口文档](./docs/api/README.md)
- [后端开发文档](./docs/backend/README.md)
- [前端开发文档](./docs/frontend/README.md)
- [Docker 配置文档](./docs/docker/README.md)

